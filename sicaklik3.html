<!DOCTYPE HTML>
<html>
<head>

<script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
<script src="https://code.highcharts.com/stock/highstock.js"></script>
<script src="https://code.highcharts.com/stock/modules/exporting.js"></script>
<div id="container" style="height: 400px"></div>

<script>
function makeLabels() {
  this.series.slice(0, this.series.length - 1).forEach(series => {
    series.statsLabels = ['min', 'max'].map((text) => {
      return this.renderer.label(text, -9999, -9999)
        .attr({
          zIndex: 6,
          align: 'center'
        })
        .css({
          fontSize: '11px',
          fontWeight: 'bold',
          color: 'contrast',
          textOutline: '1px contrast'
        })
        .add();
    });
  });
}

function calculateStatistics() {
  this.series.slice(0, this.series.length - 1).forEach(series => { // take only two first series, the last is for the navigator
    const stats = (function(series) {
      const points = series.points;
      const len = points.length;
      let i = -1,
        max = {
          y: series.dataMin
        },
        min = {
          y: series.dataMax
        },
        avg = 0;

      while (++i < len) {
        const point = points[i];

        if (point.isInside) {
          const y = point.y;

          if (y > max.y) max = point;
          if (y < min.y) min = point;

          avg += y
        }
      }

      return {
        minPoint: min,
        maxPoint: max,
        avg: (avg / i).toFixed(1)
      };
    })(series)

    // construct the legend string
    const text = `${series.name}<br>Now: ${series.options.data[series.options.data.length - 1][1]} °C<br>Max: ${stats.maxPoint.y}<br>Min: ${stats.minPoint.y}<br>Avg: ${stats.avg}`;

    // set the constructed text for the legend
    series.legendItem.attr({
      text: text
    });

    // set text in labels
    const tX = series.group.translateX;
    const tY = series.group.translateY;

    ['min', 'max'].forEach((stat, i) => {
      const p = stats[stat + 'Point'];
      series.statsLabels[i].attr({
        x: tX + p.plotX,
        y: tY + p.plotY,
        text: p.y
      })
    })
  });
}

var chart = Highcharts.stockChart('container', {

  chart: {
    zoomType: 'x',
    events: {
      load: function() {
        makeLabels.call(this);
        calculateStatistics.call(this);
      }
    }
  },
  xAxis: {
    events: {
      afterSetExtremes: function() {
        calculateStatistics.call(this.chart);
      }
    }
  },
  legend: {
    enabled: true,
    labelFormatter: function() {
      return this.name + '<br>' + 'Now: ' + '0.0' + ' °C' + '<br>Max: ' + '0.0' + '<br>Min: ' + '0.0' + '<br>Avg: ' + '0.0';
    }
  },

  plotOptions: {
    series: {
      dataLabels: {
        enabled: false,
        shape: 'callout',
        borderWidth: 1,
        borderColor: 'black',
        y: -10
      },
      dataGrouping: {
        //  enabled: false
        //  forced: true
      }
    }
  },

  series: [{
    name: 'Inside',
    data: [
      [1487687400000, 23.9],
      [1487688300000, 24.0],
      [1487689200000, 24.1],
      [1487690100000, 24.1],
      [1487691000000, 24.1],
      [1487691900000, 24.2],
      [1487692800000, 24.3],
      [1487693700000, 24.3],
      [1487694600000, 24.3],
      [1487695500000, 24.3],
      [1487696400000, 24.4],
      [1487697300000, 24.3],
      [1487698200000, 24.2],
      [1487699100000, 24.3],
      [1487700000000, 24.3],
      [1487700900000, 24.3],
      [1487701800000, 24.4],
      [1487702700000, 24.3],
      [1487703600000, 24.3],
      [1487704500000, 24.3],
      [1487705400000, 24.3],
      [1487706300000, 24.1],
      [1487707200000, 24.1],
      [1487708100000, 24.1],
      [1487709000000, 24.1],
      [1487709900000, 24.1],
      [1487710800000, 24.1],
      [1487711700000, 24.0],
      [1487712600000, 24.1],
      [1487713500000, 24.1],
      [1487714400000, 23.9],
      [1487715300000, 24.1],
      [1487716200000, 24.1],
      [1487717100000, 23.9],
      [1487718000000, 23.9],
      [1487718900000, 23.9],
      [1487719800000, 23.9],
      [1487720700000, 23.8],
      [1487721600000, 23.8],
      [1487722500000, 23.8],
      [1487723400000, 23.8],
      [1487724300000, 23.6],
      [1487725200000, 23.6],
      [1487726100000, 23.7],
      [1487727000000, 23.6],
      [1487727900000, 23.5],
      [1487728800000, 23.5],
      [1487729700000, 23.6],
      [1487730600000, 23.4],
      [1487731500000, 23.4],
      [1487732400000, 23.5],
      [1487733300000, 23.4],
      [1487734200000, 23.3],
      [1487735100000, 23.4],
      [1487736000000, 23.4],
      [1487736900000, 23.3],
      [1487737800000, 23.3],
      [1487738700000, 23.3],
      [1487739600000, 23.3],
      [1487740500000, 23.2],
      [1487741400000, 23.2],
      [1487742300000, 23.3],
      [1487743200000, 23.3],
      [1487744100000, 23.1],
      [1487745000000, 23.1],
      [1487745900000, 23.2],
      [1487746800000, 23.1],
      [1487747700000, 23.1],
      [1487748600000, 23.1],
      [1487749500000, 23.2],
      [1487750400000, 23.1],
      [1487751300000, 23.1],
      [1487752200000, 23.2],
      [1487753100000, 23.1],
      [1487754000000, 23.1],
      [1487754900000, 23.1],
      [1487755800000, 23.2],
      [1487756700000, 23.1],
      [1487757600000, 23.0],
      [1487758500000, 23.1],
      [1487759400000, 23.2],
      [1487760300000, 23.1],
      [1487761200000, 23.1],
      [1487762100000, 23.2],
      [1487763000000, 23.2],
      [1487763900000, 23.3],
      [1487764800000, 23.1],
      [1487765700000, 23.1],
      [1487766600000, 23.2],
      [1487767500000, 23.3],
      [1487768400000, 23.2],
      [1487769300000, 23.2],
      [1487770200000, 23.3],
      [1487771100000, 23.3],
      [1487772000000, 23.2],
      [1487772900000, 23.3],
      [1487773800000, 23.3],
      [1487774700000, 23.3],
      [1487775600000, 23.3],
      [1487776500000, 23.4],
      [1487777400000, 23.3],
      [1487778300000, 23.3],
      [1487779200000, 23.3],
      [1487780100000, 23.4],
      [1487781000000, 23.3],
      [1487781900000, 23.3],
      [1487782800000, 23.3],
      [1487783700000, 23.3],
      [1487784600000, 23.2],
      [1487785500000, 23.3],
      [1487786400000, 23.3],
      [1487787300000, 23.3],
      [1487788200000, 23.2],
      [1487789100000, 23.3],
      [1487790000000, 23.3],
      [1487790900000, 23.4],
      [1487791800000, 23.4],
      [1487792700000, 23.4],
      [1487793600000, 23.5],
      [1487794500000, 23.5],
      [1487795400000, 23.5],
      [1487796300000, 23.6],
      [1487797200000, 23.6],
      [1487798100000, 23.6],
      [1487799000000, 23.6],
      [1487799900000, 23.6],
      [1487800800000, 23.6],
      [1487801700000, 23.4],
      [1487802600000, 23.3],
      [1487803500000, 23.0],
      [1487804400000, 22.8],
      [1487805300000, 22.7],
      [1487806200000, 22.7],
      [1487807100000, 22.8],
      [1487808000000, 22.9],
      [1487808900000, 23.0],
      [1487809800000, 23.0],
      [1487810700000, 23.0],
      [1487811600000, 23.1],
      [1487812500000, 23.1],
      [1487813400000, 23.1],
      [1487814300000, 23.1],
      [1487815200000, 23.1],
      [1487816100000, 23.1],
      [1487817000000, 23.1],
      [1487817900000, 23.1],
      [1487818800000, 23.2],
      [1487819700000, 23.1],
      [1487820600000, 23.1],
      [1487821500000, 23.2],
      [1487822400000, 23.2],
      [1487823300000, 23.1],
      [1487824200000, 23.1],
      [1487825100000, 23.3],
      [1487826000000, 23.1],
      [1487826900000, 23.1],
      [1487827800000, 23.1],
      [1487828700000, 23.2],
      [1487829600000, 23.2],
      [1487830500000, 23.1],
      [1487831400000, 23.2],
      [1487832300000, 23.2],
      [1487833200000, 23.1],
      [1487834100000, 23.1],
      [1487835000000, 23.1],
      [1487835900000, 23.2],
      [1487836800000, 23.2],
      [1487837700000, 23.3],
      [1487838600000, 23.4],
      [1487839500000, 23.5],
      [1487840400000, 23.4],
      [1487841300000, 23.6],
      [1487842200000, 23.8],
      [1487843100000, 23.8],
      [1487844000000, 23.7],
      [1487844900000, 23.8],
      [1487845800000, 23.9],
      [1487846700000, 23.8],
      [1487847600000, 23.8],
      [1487848500000, 23.9],
      [1487849400000, 23.8],
      [1487850300000, 23.8],
      [1487851200000, 23.8],
      [1487852100000, 23.9],
      [1487853000000, 23.8],
      [1487853900000, 23.8],
      [1487854800000, 23.8],
      [1487855700000, 23.9],
      [1487856600000, 23.9],
      [1487857500000, 24.1],
      [1487858400000, 24.1],
      [1487859300000, 24.3],
      [1487860200000, 24.3],
      [1487861100000, 24.3],
      [1487862000000, 24.2],
      [1487862900000, 24.2],
      [1487863800000, 24.1],
      [1487864700000, 24.1],
      [1487865600000, 24.1]
    ]
  }, {
    name: 'Outside',
    data: [
      [1487687400000, -1.4],
      [1487688300000, -1.6],
      [1487689200000, -1.8],
      [1487690100000, -2.2],
      [1487691000000, -2.5],
      [1487691900000, -3.1],
      [1487692800000, -3.2],
      [1487693700000, -3.4],
      [1487694600000, -3.6],
      [1487695500000, -4.1],
      [1487696400000, -4.4],
      [1487697300000, -4.6],
      [1487698200000, -5.0],
      [1487699100000, -4.9],
      [1487700000000, -4.9],
      [1487700900000, -5.2],
      [1487701800000, -5.3],
      [1487702700000, -5.7],
      [1487703600000, -5.6],
      [1487704500000, -5.4],
      [1487705400000, -5.3],
      [1487706300000, -5.4],
      [1487707200000, -5.6],
      [1487708100000, -5.5],
      [1487709000000, -5.2],
      [1487709900000, -5.6],
      [1487710800000, -5.8],
      [1487711700000, -5.8],
      [1487712600000, -5.7],
      [1487713500000, -5.2],
      [1487714400000, -5.0],
      [1487715300000, -5.0],
      [1487716200000, -4.9],
      [1487717100000, -4.9],
      [1487718000000, -5.0],
      [1487718900000, -5.2],
      [1487719800000, -5.4],
      [1487720700000, -5.4],
      [1487721600000, -4.8],
      [1487722500000, -4.3],
      [1487723400000, -4.1],
      [1487724300000, -3.9],
      [1487725200000, -3.8],
      [1487726100000, -3.6],
      [1487727000000, -3.5],
      [1487727900000, -3.4],
      [1487728800000, -3.3],
      [1487729700000, -3.1],
      [1487730600000, -3.0],
      [1487731500000, -2.9],
      [1487732400000, -2.8],
      [1487733300000, -2.6],
      [1487734200000, -2.6],
      [1487735100000, -2.5],
      [1487736000000, -2.4],
      [1487736900000, -2.3],
      [1487737800000, -2.2],
      [1487738700000, -2.2],
      [1487739600000, -2.0],
      [1487740500000, -1.9],
      [1487741400000, -1.9],
      [1487742300000, -1.8],
      [1487743200000, -1.8],
      [1487744100000, -1.7],
      [1487745000000, -1.6],
      [1487745900000, -1.6],
      [1487746800000, -1.8],
      [1487747700000, -1.9],
      [1487748600000, -1.9],
      [1487749500000, -1.8],
      [1487750400000, -1.6],
      [1487751300000, -1.4],
      [1487752200000, -1.1],
      [1487753100000, -1.0],
      [1487754000000, -0.9],
      [1487754900000, -0.7],
      [1487755800000, -0.6],
      [1487756700000, -0.5],
      [1487757600000, -0.3],
      [1487758500000, -0.3],
      [1487759400000, -0.1],
      [1487760300000, 0.0],
      [1487761200000, 0.1],
      [1487762100000, 0.3],
      [1487763000000, 0.3],
      [1487763900000, 0.4],
      [1487764800000, 0.5],
      [1487765700000, 0.6],
      [1487766600000, 0.6],
      [1487767500000, 0.7],
      [1487768400000, 0.8],
      [1487769300000, 0.8],
      [1487770200000, 0.7],
      [1487771100000, 0.6],
      [1487772000000, 0.5],
      [1487772900000, 0.5],
      [1487773800000, 0.4],
      [1487774700000, 0.4],
      [1487775600000, 0.3],
      [1487776500000, 0.1],
      [1487777400000, -0.1],
      [1487778300000, -0.3],
      [1487779200000, -0.3],
      [1487780100000, -0.4],
      [1487781000000, -0.5],
      [1487781900000, -0.6],
      [1487782800000, -0.7],
      [1487783700000, -0.8],
      [1487784600000, -0.8],
      [1487785500000, -0.8],
      [1487786400000, -0.9],
      [1487787300000, -0.9],
      [1487788200000, -1.1],
      [1487789100000, -1.1],
      [1487790000000, -1.2],
      [1487790900000, -1.3],
      [1487791800000, -1.3],
      [1487792700000, -1.4],
      [1487793600000, -1.4],
      [1487794500000, -1.4],
      [1487795400000, -1.5],
      [1487796300000, -1.5],
      [1487797200000, -1.6],
      [1487798100000, -1.6],
      [1487799000000, -1.7],
      [1487799900000, -1.8],
      [1487800800000, -1.9],
      [1487801700000, -1.9],
      [1487802600000, -1.9],
      [1487803500000, -2.1],
      [1487804400000, -2.2],
      [1487805300000, -2.2],
      [1487806200000, -2.3],
      [1487807100000, -2.3],
      [1487808000000, -2.3],
      [1487808900000, -2.3],
      [1487809800000, -2.3],
      [1487810700000, -2.4],
      [1487811600000, -2.4],
      [1487812500000, -2.4],
      [1487813400000, -2.5],
      [1487814300000, -2.5],
      [1487815200000, -2.5],
      [1487816100000, -2.5],
      [1487817000000, -2.6],
      [1487817900000, -2.6],
      [1487818800000, -2.5],
      [1487819700000, -2.6],
      [1487820600000, -2.6],
      [1487821500000, -2.6],
      [1487822400000, -2.6],
      [1487823300000, -2.6],
      [1487824200000, -2.8],
      [1487825100000, -2.9],
      [1487826000000, -3.1],
      [1487826900000, -3.3],
      [1487827800000, -3.4],
      [1487828700000, -3.5],
      [1487829600000, -3.6],
      [1487830500000, -3.6],
      [1487831400000, -3.6],
      [1487832300000, -3.6],
      [1487833200000, -3.7],
      [1487834100000, -3.7],
      [1487835000000, -3.8],
      [1487835900000, -3.8],
      [1487836800000, -3.8],
      [1487837700000, -3.9],
      [1487838600000, -3.9],
      [1487839500000, -3.8],
      [1487840400000, -3.8],
      [1487841300000, -3.7],
      [1487842200000, -3.7],
      [1487843100000, -3.6],
      [1487844000000, -3.6],
      [1487844900000, -3.4],
      [1487845800000, -3.5],
      [1487846700000, -3.5],
      [1487847600000, -3.6],
      [1487848500000, -3.6],
      [1487849400000, -3.5],
      [1487850300000, -3.4],
      [1487851200000, -3.4],
      [1487852100000, -3.3],
      [1487853000000, -3.6],
      [1487853900000, -3.9],
      [1487854800000, -3.6],
      [1487855700000, -3.4],
      [1487856600000, -3.1],
      [1487857500000, -3.3],
      [1487858400000, -3.3],
      [1487859300000, -3.4],
      [1487860200000, -3.4],
      [1487861100000, -3.5],
      [1487862000000, -3.6],
      [1487862900000, -3.8],
      [1487863800000, -3.9],
      [1487864700000, -4.1],
      [1487865600000, -4.2]
    ]
  }]

});

</script>
</head>
</html>
